<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Let&#39;s Write Redux - Ken Gorab</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="This is a copy of a post, originally written on Medium. I&#39;ve since rehosted it on my own site.
As a corollary to the famous sentiment “the best way to prove mastery over a topic is to be able to teach it to somebody else”, I’d like to add “the best way to prove mastery over a piece of software it to implement it yourself.” I don’t know whether or not that’s true, but I do often enjoy building my own versions of the tools/libraries that I use."/>
<meta name="keywords" content="senior software engineer nyc programming java javascript typescript react golang ruby rust"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/2018/03/lets-write-redux/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Let&#39;s Write Redux"/>
<meta name="twitter:description" content="This is a copy of a post, originally written on Medium. I&#39;ve since rehosted it on my own site.
As a corollary to the famous sentiment “the best way to prove mastery over a topic is to be able to teach it to somebody else”, I’d like to add “the best way to prove mastery over a piece of software it to implement it yourself.” I don’t know whether or not that’s true, but I do often enjoy building my own versions of the tools/libraries that I use."/>



<meta property="og:title" content="Let&#39;s Write Redux" />
<meta property="og:description" content="This is a copy of a post, originally written on Medium. I&#39;ve since rehosted it on my own site.
As a corollary to the famous sentiment “the best way to prove mastery over a topic is to be able to teach it to somebody else”, I’d like to add “the best way to prove mastery over a piece of software it to implement it yourself.” I don’t know whether or not that’s true, but I do often enjoy building my own versions of the tools/libraries that I use." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2018/03/lets-write-redux/" />
<meta property="article:published_time" content="2018-03-05T20:07:56-05:00" />
<meta property="article:modified_time" content="2018-03-05T20:07:56-05:00" /><meta property="og:site_name" content="Ken Gorab" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">~ken.gorab</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/me">About</a></li>
        
      
        
          <li><a href="/">Posts</a></li>
        
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/me">About</a></li>
      
    
      
        <li><a href="/">Posts</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/posts/2018/03/lets-write-redux/">Let's Write Redux</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            Mar 5, 2018
        </span>
      
      
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/redux/">redux</a>&nbsp;
        
          #<a href="/tags/javascript/">javascript</a>&nbsp;
        
          #<a href="/tags/diy/">diy</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      <p><em>This is a copy of a post, <a href="https://medium.com/@ken.gorab/lets-write-redux-9f6cb511b3e4">originally written on Medium</a>. I've since rehosted it on my own site.</em></p>
<p>As a corollary to the famous sentiment “the best way to prove mastery over a topic is to be able to teach it to somebody else”, I’d like to add “the best way to prove mastery over a piece of software it to implement it yourself.” I don’t know whether or not that’s true, but I do often enjoy building my own versions of the tools/libraries that I use. Not in any serious production environment or anything, just for the sake of learning how they work.</p>
<p>Anyway, now that the preamble is done, let’s write <a href="https://redux.js.org/">Redux</a>!</p>
<h2 id="what-is-redux">What Is Redux?</h2>
<p>According to the documentation, it’s this:</p>
<blockquote>
<p>Redux is a predictable state container for JavaScript apps.</p>
</blockquote>
<p>I’m not going to spend too much time talking about what Redux is (that’s not the point of this) but there are a couple of key parts which I need to mention.
First is the <strong>store</strong>, which is what houses your application’s data; second is the <strong>reducer function(s)</strong> which allow(s) you to define the per-action rules by which your store can be changed; lastly there is the <strong>dispatch function</strong> which allows you to specify the action that has occurred. The <strong>dispatch function</strong> is the gateway to changing state in Redux.</p>
<p>With that said, let’s get started writing Redux with the simple example from Redux’s README.</p>
<h2 id="step-1-a-very-basic-example">Step 1: A Very Basic Example</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">counter</span>(<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">action</span>) {
 <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">action</span>.<span style="color:#a6e22e">type</span>) {
   <span style="color:#66d9ef">case</span> <span style="color:#960050;background-color:#1e0010">‘</span><span style="color:#a6e22e">INCREMENT</span><span style="color:#960050;background-color:#1e0010">’</span><span style="color:#f92672">:</span>
     <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
   <span style="color:#66d9ef">case</span> <span style="color:#960050;background-color:#1e0010">‘</span><span style="color:#a6e22e">DECREMENT</span><span style="color:#960050;background-color:#1e0010">’</span><span style="color:#f92672">:</span>
     <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span> <span style="color:#960050;background-color:#1e0010">—</span> <span style="color:#ae81ff">1</span>
   <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
     <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span>
 }
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">store</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createStore</span>(<span style="color:#a6e22e">counter</span>)

<span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">subscribe</span>(() =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">getState</span>()))

<span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">dispatch</span>({ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">‘</span><span style="color:#a6e22e">INCREMENT</span><span style="color:#960050;background-color:#1e0010">’</span> }) <span style="color:#75715e">// logs 1
</span><span style="color:#75715e"></span><span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">dispatch</span>({ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">‘</span><span style="color:#a6e22e">INCREMENT</span><span style="color:#960050;background-color:#1e0010">’</span> }) <span style="color:#75715e">// logs 2
</span><span style="color:#75715e"></span><span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">dispatch</span>({ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">‘</span><span style="color:#a6e22e">DECREMENT</span><span style="color:#960050;background-color:#1e0010">’</span> }) <span style="color:#75715e">// logs 1
</span></code></pre></div><p>Though this example is extremely basic, it lays out nearly all aspects of Redux: the <strong>store</strong> (created with the <code>createStore</code> function) which consists only of 1 number, the <strong>reducer function</strong>, and the <strong>dispatch function</strong>.</p>
<p>Here’s what a skeleton of the <code>createStore</code> function might look like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createStore</span>(<span style="color:#a6e22e">reducer</span>) {
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">callback</span>) {
    <span style="color:#75715e">// TODO
</span><span style="color:#75715e"></span>  }
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getState</span>() {
    <span style="color:#75715e">// TODO
</span><span style="color:#75715e"></span>  }
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">action</span>) {
    <span style="color:#75715e">// TODO
</span><span style="color:#75715e"></span>  }
  
  <span style="color:#66d9ef">return</span> {
    <span style="color:#a6e22e">subscribe</span>,
    <span style="color:#a6e22e">getState</span>,
    <span style="color:#a6e22e">dispatch</span>
  }
}
</code></pre></div><p>If it helps to think in terms of object-oriented programming, this <code>createStore</code> function is kind of acting as a class, which would have methods <code>subscribe</code>, <code>getState</code>, and <code>dispatch</code>. You <em>can</em> write classes in javascript now (since ES2015), but to keep parity with the existing Redux API, I’ll stick with the functional approach. (For more reading on classes vs factory functions in javascript, I recommend <a href="https://medium.com/javascript-scene/javascript-factory-functions-vs-constructor-functions-vs-classes-2f22ceddf33e">this Medium post</a>).</p>
<p>Let’s tackle the easiest functions first. The <code>subscribe</code> function simply registers a callback which will be invoked on every state change; this one is super easy. The <code>getState</code> function should return the existing state of the store, which means we’ll need a variable to keep track of it (you can think of this as an <em>instance variable</em> in OOP-terminology). So, we’re now at this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createStore</span>(<span style="color:#a6e22e">reducer</span>) {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">callback</span>
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">currentState</span>
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">cb</span>) {
    <span style="color:#a6e22e">callback</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cb</span>
  }
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getState</span>() {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">currentState</span>
  }
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">action</span>) {
    <span style="color:#75715e">// TODO still
</span><span style="color:#75715e"></span>  }
  
  <span style="color:#66d9ef">return</span> {
    <span style="color:#a6e22e">subscribe</span>,
    <span style="color:#a6e22e">getState</span>,
    <span style="color:#a6e22e">dispatch</span>
  }
}
</code></pre></div><p>Nothing earth-shattering yet, I hope. The final piece of the puzzle is the <code>dispatch</code> function. This function receives an action as a parameter, and is the gateway to all state changes within Redux. An <strong>action</strong> is simply an object literal that has a <code>type</code> property on it (you can see that the type is the subject of the <code>switch</code> statement in the reducer function, which is a very common pattern in reducer functions). The job of <code>dispatch</code> is to call the reducer function (<code>counter</code> in the simple example above) with the current state and the action it received. The return value from that reducer should then become the current state. Finally, it should invoke the subscription callback registered in the <code>subscribe</code> function. If that sounds like a lot, don’t worry it’s really not.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createStore</span>(<span style="color:#a6e22e">reducer</span>) {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">callback</span>
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">currentState</span>
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">cb</span>) {
    <span style="color:#a6e22e">callback</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cb</span>
  }
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getState</span>() {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">currentState</span>
  }
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">action</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newState</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">reducer</span>(<span style="color:#a6e22e">currentState</span>, <span style="color:#a6e22e">action</span>)
    <span style="color:#a6e22e">currentState</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newState</span>;
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">callback</span>) {
      <span style="color:#a6e22e">callback</span>()
    }
  }
  
  <span style="color:#66d9ef">return</span> {
    <span style="color:#a6e22e">subscribe</span>,
    <span style="color:#a6e22e">getState</span>,
    <span style="color:#a6e22e">dispatch</span>
  }
}
</code></pre></div><div class="caption">Lines 14-18 are the new part</div>
<p>See, I told you it wasn’t a lot. The <code>reducer</code> that we invoke here is the function that was passed as a parameter to the <code>createStore</code> function, and it represents the <strong>top-level reducer</strong> (in the simple example, the top-level reducer is just the <code>counter</code> function, but this will eventually get more complicated in later examples). Whatever the reducer function returns will become the new state.</p>
<p>And we’re done! Well, almost. There are a few subtle things about the reducer function which were kind of glossed over. Let’s pull up that code again:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">counter</span>(<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">action</span>) {
 <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">action</span>.<span style="color:#a6e22e">type</span>) {
   <span style="color:#66d9ef">case</span> <span style="color:#960050;background-color:#1e0010">‘</span><span style="color:#a6e22e">INCREMENT</span><span style="color:#960050;background-color:#1e0010">’</span><span style="color:#f92672">:</span>
     <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
   <span style="color:#66d9ef">case</span> <span style="color:#960050;background-color:#1e0010">‘</span><span style="color:#a6e22e">DECREMENT</span><span style="color:#960050;background-color:#1e0010">’</span><span style="color:#f92672">:</span>
     <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span> <span style="color:#960050;background-color:#1e0010">—</span> <span style="color:#ae81ff">1</span>
   <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
     <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span>
 }
}
</code></pre></div><p>I think the single trickiest thing about reducer functions is the fact that Redux will call your reducer for <em>every</em> action; this is why it’s important that your reducer functions return the state that they’re passed (which will be the <code>currentState</code>) for action types that you don’t care about. Relatedly, state initially starts off as <code>undefined</code>, which would result in unexpected <code>NaN</code>s later on if not for that default parameter value in the function declaration.</p>
<p>One thing Redux does which we do not yet do, is fire off some unique action once the store has finished initializing such that no reducers handle that action. This effectively builds out the initial state since the reducer function will return its default value. To ensure the uniqueness of that action name (so nobody can write bad code which depends on Redux’s internals) Redux appends a randomized string to the end of that action. This is the last step in our implementation of <code>createStore</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createStore</span>(<span style="color:#a6e22e">reducer</span>) {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">callback</span>
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">currentState</span>
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">cb</span>) {
    <span style="color:#a6e22e">callback</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cb</span>
  }
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getState</span>() {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">currentState</span>
  }
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">action</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newState</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">reducer</span>(<span style="color:#a6e22e">currentState</span>, <span style="color:#a6e22e">action</span>)
    <span style="color:#a6e22e">currentState</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newState</span>;
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">callback</span>) {
      <span style="color:#a6e22e">callback</span>()
    }
  }
  
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">INIT_ACTION</span> <span style="color:#f92672">=</span> 
    <span style="color:#e6db74">&#39;INIT_&#39;</span> <span style="color:#f92672">+</span> Math.<span style="color:#a6e22e">random</span>()
      .<span style="color:#a6e22e">toString</span>(<span style="color:#ae81ff">36</span>)
      .<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">7</span>)
      .<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;&#39;</span>)
      .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;.&#39;</span>)
  <span style="color:#a6e22e">dispatch</span>({ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">INIT_ACTION</span> })
  
  <span style="color:#66d9ef">return</span> {
    <span style="color:#a6e22e">subscribe</span>,
    <span style="color:#a6e22e">getState</span>,
    <span style="color:#a6e22e">dispatch</span>
  }
}
</code></pre></div><div class="caption">Note the call to dispatch on line 27</div>
<p>Okay, now we’re done. <a href="https://codepen.io/anon/pen/rJgMwL?editors=0012">Here is a codepen</a> of the simple example and our implementation of Redux to handle it. I think it’s time to step up the complexity a bit. Though really, it’s not that large a step.</p>
<h2 id="step-2-combining-reducers">Step 2: Combining Reducers</h2>
<p>In the simple example above, the state consisted of a single number, a counter. That was fine for a simple example, but let’s try to tackle a more complex state; let’s build the state for a Todo App (yeah, I know it’s a bit tired at this point, but it’s a good example of a structure which many people understand, and it’s <a href="https://redux.js.org/basics/reducers">the example in the Redux documentation</a>).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">visibilityFilter</span>(<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;SHOW_ALL&#39;</span>, <span style="color:#a6e22e">action</span>) {
  <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">action</span>.<span style="color:#a6e22e">type</span>) {
    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;SET_VISIBILITY_FILTER&#39;</span><span style="color:#f92672">:</span>
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">action</span>.<span style="color:#a6e22e">filter</span>
    <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span>
  }
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">todos</span>(<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> [], <span style="color:#a6e22e">action</span>) {
  <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">action</span>.<span style="color:#a6e22e">type</span>) {
    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;ADD_TODO&#39;</span><span style="color:#f92672">:</span>
      <span style="color:#66d9ef">return</span> [
        ...<span style="color:#a6e22e">state</span>,
        {
          <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">action</span>.<span style="color:#a6e22e">text</span>,
          <span style="color:#a6e22e">completed</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
        }
      ]
    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;TOGGLE_TODO&#39;</span><span style="color:#f92672">:</span>
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">todo</span>, <span style="color:#a6e22e">index</span>) =&gt; {
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">index</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">action</span>.<span style="color:#a6e22e">index</span>) {
          <span style="color:#66d9ef">return</span> { ...<span style="color:#a6e22e">todo</span>, <span style="color:#a6e22e">completed</span><span style="color:#f92672">:</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">todo</span>.<span style="color:#a6e22e">completed</span> }
        }
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">todo</span>
      })
    <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">state</span>
  }
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">topLevelReducer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">combineReducers</span>({
  <span style="color:#a6e22e">visibilityFilter</span>,
  <span style="color:#a6e22e">todos</span>
})

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">store</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createStore</span>(<span style="color:#a6e22e">topLevelReducer</span>)
</code></pre></div><p>Here we have two reducer functions, <code>todos</code> and <code>visibilityFilter</code>, which are passed into <code>combineReducers</code> to create a single top-level reducer. This top-level reducer is passed into the <code>createStore</code> call, like we’ve seen before. Really the only difference is that <code>combineReducers</code> function, so let’s dive into what that’s supposed to do.</p>
<p>Judging by the documentation, the result of that <code>combineReducers</code> function is <em>itself</em> a reducer function, which returns an object of the shape</p>
<pre><code>{
  visibilityFilter: ???,
  todos: ???
}
</code></pre><p>where the <code>???</code>s are the return values of each of those separate reducer functions. At this point I’ve typed the word “function” so much it’s starting to not look like a word anymore; let’s write the code for <code>combineReducers</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">combineReducers</span>(<span style="color:#a6e22e">reducers</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {}, <span style="color:#a6e22e">action</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nextState</span> <span style="color:#f92672">=</span> {}

    Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">reducers</span>).<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">key</span> =&gt; {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">previousStateForKey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">state</span>[<span style="color:#a6e22e">key</span>]
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reducerForKey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">reducers</span>[<span style="color:#a6e22e">key</span>]
      
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nextStateForKey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">reducerForKey</span>(<span style="color:#a6e22e">previousStateForKey</span>, <span style="color:#a6e22e">action</span>)
      <span style="color:#a6e22e">nextState</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">nextStateForKey</span>
    })
    
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">nextState</span>
  }
}
</code></pre></div><p>Nothing magical going on here; the <code>reducers</code> map / object literal which was passed to <code>combineReducers</code> outlines the shape of the state and defines which reducer function maps to which property on the state. The return value of <code>combineReducers</code> is a reducer function itself which builds an empty object literal to represent the next state, calls each of its reducer functions with their previous sub-section of the state and the current action, and then assembles them all back together. Once you understand how ordinary reducer functions work, a “combined” reducer function is really nothing special.</p>
<p><a href="https://codepen.io/anon/pen/LQKxXp?editors=0011">Here is a codepen</a> of the working Todo example, using our <code>combineReducers</code> and <code>createStore</code> functions, and here is our entire implementation of basic Redux, in 50 lines:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createStore</span>(<span style="color:#a6e22e">reducer</span>) {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">callback</span>
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">currentState</span>
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">cb</span>) {
    <span style="color:#a6e22e">callback</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cb</span>
  }
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getState</span>() {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">currentState</span>
  }
  
  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">action</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newState</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">reducer</span>(<span style="color:#a6e22e">currentState</span>, <span style="color:#a6e22e">action</span>)
    <span style="color:#a6e22e">currentState</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newState</span>;
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">callback</span>) {
      <span style="color:#a6e22e">callback</span>()
    }
  }
  
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">INIT_ACTION</span> <span style="color:#f92672">=</span> 
    <span style="color:#e6db74">&#39;INIT_&#39;</span> <span style="color:#f92672">+</span> Math.<span style="color:#a6e22e">random</span>()
      .<span style="color:#a6e22e">toString</span>(<span style="color:#ae81ff">36</span>)
      .<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">7</span>)
      .<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;&#39;</span>)
      .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;.&#39;</span>)
  <span style="color:#a6e22e">dispatch</span>({ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">INIT_ACTION</span> })
  
  <span style="color:#66d9ef">return</span> {
    <span style="color:#a6e22e">subscribe</span>,
    <span style="color:#a6e22e">getState</span>,
    <span style="color:#a6e22e">dispatch</span>
  }
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">combineReducers</span>(<span style="color:#a6e22e">reducers</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {}, <span style="color:#a6e22e">action</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nextState</span> <span style="color:#f92672">=</span> {}

    Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">reducers</span>).<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">key</span> =&gt; {
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">previousStateForKey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">state</span>[<span style="color:#a6e22e">key</span>]
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reducerForKey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">reducers</span>[<span style="color:#a6e22e">key</span>]
      
      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">nextStateForKey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">reducerForKey</span>(<span style="color:#a6e22e">previousStateForKey</span>, <span style="color:#a6e22e">action</span>)
      <span style="color:#a6e22e">nextState</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">nextStateForKey</span>
    })
    
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">nextState</span>
  }
}
</code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>That’s really all there is to basic Redux. I always recommend to anyone interested in using Redux that they read through <a href="https://github.com/reactjs/redux/tree/master/src">the source</a> because there really isn’t much to it. Sure, the actual library has logging, assertions about the shape of the state, null-checking, and other such things, but the core functionality of Redux really is quite simple; all it’s really doing is calling your functions in the right order and assembling them together in the shapes you describe.</p>
<p>That being said though, there are a couple of things that I left out. The <code>createStore</code> function also optionally accepts 2 additional parameters: <code>preloadedState</code> and <code>enhancer</code>. The first allows you to define an initial value for your entire state up-front, for defrosting some persisted/stored state, or for many other reasons. Implementing this one is really as simple as assigning <code>currentState</code> to that value at the start instead of having it be undefined.</p>
<p>The second parameter, <code>enhancer</code> has a bit more to it, but it’s still not overly complex. An enhancer is a function which you can provide in order to modify Redux slightly in order to achieve certain things. For example, the concept of “middleware” or “functions that get automatically called on every dispatch” is achieved via an enhancer. I definitely recommend you check out <a href="https://redux.js.org/advanced/middleware">the official Redux documentation</a> for this, as it walks through exactly how and why middlewares are useful, and I recommend you check out the <a href="https://github.com/reduxjs/redux/blob/master/src/applyMiddleware.ts"><code>applyMiddleware</code></a> function in Redux’s code for an example of an enhancer function.</p>
<h2 id="to-be-continued">To Be Continued?</h2>
<p>Most practical uses of Redux include making HTTP requests (or some other kind of asynchronous actions) or using it alongside some view library (React, for example). If I feel like it, I might write up a “Let’s Write Redux-React” or “Let’s Write Redux-Thunk” post at some point. But I think I’ll leave it here for now.</p>
<p>Thank you for reading, and I hope that helps demystify Redux a bit.</p>

    </div>
    

    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>© 2020 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
